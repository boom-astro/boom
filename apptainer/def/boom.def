Bootstrap: docker
From: rust:1.87-slim-bookworm

%environment
    export PATH=/app:$PATH

%files
    Cargo.toml /app/Cargo.toml
    Cargo.lock /app/Cargo.lock
    src /app/src
    api /app/api
    data/models /app/data/models
    data/alerts /app/alerts

%post
    apt-get update && \
    apt-get install -y \
        curl gcc g++ make perl \
        libhdf5-dev libsasl2-dev \
        libssl-dev pkg-config && \
    apt-get autoremove && apt-get clean && rm -rf /var/lib/apt/lists/*

    cd /app
    cargo build --release --workspace

    cp /app/target/release/kafka_producer /app/kafka_producer
    cp /app/target/release/kafka_consumer /app/kafka_consumer
    cp /app/target/release/scheduler /app/scheduler